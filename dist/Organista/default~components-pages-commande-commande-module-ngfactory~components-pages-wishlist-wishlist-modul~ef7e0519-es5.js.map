{"version":3,"sources":["webpack:///src/app/services/commandes/commande.service.ts"],"names":["CommandeService","http","router","panierService","token","localStorage","getItem","iduser","testvar","terminate","headers","get","apiURL","data","listprod","re","fire","showLoading","getDenyButton","idcommande","commande","venteId","userId","vendeurID","quantitetotalCommande","montantTotaCommande","String","Math","floor","random","montantlivraison","body","JSON","stringify","post","subscribe","res","icon","title","text","showConfirmButton","timer","navigate","number","length","item","AddProduitCommande","listenumer","console","log","produitcommande","price","qty","idprod","id","alert","push","newquantite","vente","quantite","error","ventes","rep","setItem","api_auth"],"mappings":"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","file":"default~components-pages-commande-commande-module-ngfactory~components-pages-wishlist-wishlist-modul~ef7e0519-es5.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { Observable, of } from 'rxjs'\nimport { GlobalConstants } from '../../common/global-constants';\nimport Swal from 'sweetalert2';\nimport { Router } from '@angular/router';\nimport { PanierService } from '../paniers/panier.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CommandeService {\n\n  constructor(public http:HttpClient,public router:Router,public panierService: PanierService) { }\n  token =  localStorage.getItem('token')\n   iduser = localStorage.getItem('iduser');\n\n testvar:any = []\n\n\n\n\n  // var commandeGenerale = {\n  //   \"quantitetotalCommande\":quantitetotalCommande,\n  //   \"montantTotaCommande\":montantTotaCommande,\n  //   \"montantlivraison\":montantlivraison,\n  //   \"statut\":statut,\n  //   \"numero_commande\":numero_commande,\n  //   \"vendeurID\":vendeurID,\n  //   \"userId\":iduser\n  //  }\n\n  GetCommandeByuser(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.apiURL+\"/commandes/getuserIdcommande/\"+this.iduser+\".json\",{ headers: headers })\n  }\n  GetProduitBycomamnde(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.apiURL+\"/produitcommande/listProduitcommande.json\",{ headers: headers })\n  }\n\n  terminate =false\n  AddCommande(data,listprod){\n    let  re =  false;\n    Swal.fire('Patientez svp!!!')\n    Swal.showLoading(Swal.getDenyButton())\n    var idcommande = 0;\n    let commande = {\n    \"venteId\":data.venteId,\n    \"userId\": data.userId,\n    \"vendeurId\":data.vendeurID,\n    \"quantite\":data.quantitetotalCommande,\n    \"montant\":data.montantTotaCommande,\n    \"statut\":\"en attente\",\n    \"numero_commande\":String(Math.floor(100000 + Math.random() * 900000)),\n    \"montantlivraison\":data.montantlivraison\n    }\n    this.token = localStorage.getItem('token')\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n    })\n    const body=JSON.stringify(commande);\n   // console.log(this.token);\n    // console.log(\"voici le token dans commande : \",this.token)\n    // console.log(\"voici le token dans commande : \",this.iduser)\n\n    this.http\n     .post(GlobalConstants.apiURL+'/commandes/addCommandes.json', body, {\n       headers: headers,\n     })\n    .subscribe((res) =>{\n\n\n  //  console.log(res);\n\n    if(res['message']===\"authentication failed Token not valide\"){\n      \n        Swal.fire({\n          icon: 'error',\n          title: 'Commande refusé',\n          text: 'Votre session a expiré!',\n          showConfirmButton: true,\n          timer: 2000\n        });\n        this.router.navigate(['/login']);\n         re = false\n     }\n    else if(res['response']['code'] === \"200\"){\n      \n    //  Swal.fire({\n    //   icon: 'success',\n    //   title: 'Commande effectuée',\n    //   text: 'Merci pour votre commande!',\n    //   showConfirmButton: true,\n    //   timer: 2000\n    //  });\n     idcommande = res['response']['idcommande']\n     var number =listprod.length\n     for(const item of listprod) {\n       number -= 1;\n      // console.log(item)\n        this.AddProduitCommande(item,number,idcommande)\n     }\n     //this.panierService.removePanier();\n     //this.cart = []\n    // console.log(idcommande)\n   //this.panierService.removePanier()\n    //this.router.navigate(['/login']);\n    \n     re = true  \n    }\n    else if(res['response']['code'] === \"404\"){\n\n      Swal.fire({\n        icon: 'error',\n        title: 'Commande refusé!',\n        text: 'Veuillez contactez le service client!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n      re = false\n    }else{\n     //this.alertConfirmation()\n     Swal.fire({\n      icon: 'error',\n      title: 'Commande refusé!',\n      text: 'veuillez verifier votre connexion internet!',\n      showConfirmButton: true,\n      timer: 2000\n    });\n    re =false\n     }\n    }\n   );\n   return re;\n  }\n  AddProduitCommande(data,listenumer:number,idcommande){\n    //Swal.fire('Patientez svp!!!')\n    //Swal.showLoading(Swal.getDenyButton())\n    console.log(listenumer)\n    let produitcommande = {\n      \"idcommande\":idcommande,\n      \"titre\":data.title,\n      \"prixunitaire\":data.price,\n      \"quantite\":data.qty,\n      \"Idvendeur\":data.idprod,\n      \"idvente\":data.id\n    }\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n    })\n    const body=JSON.stringify(produitcommande);\n    var alert= true;\n    console.log(this.token);\n    this.http\n     .post(GlobalConstants.apiURL+'/produitcommande/addProduitcommande.json', body, {\n       headers: headers,\n     })\n\n    .subscribe((res) =>{\n    console.log(res);\n    if(res['message']===\"authentication failed Token not valide\"){\n      if(listenumer ===0){\n        Swal.fire({\n          icon: 'error',\n          title: 'Commande refusé',\n          text: 'Votre session a expiré!',\n          showConfirmButton: true,\n          timer: 2000\n        });\n        this.router.navigate(['/login']);\n      }\n\n     }\n    else if(res['response']['code'] === \"200\"){\n      if(listenumer ===0){\n        this.testvar.push(\"1\");\n        console.log(\"this.testvar :\",this.testvar);\n      Swal.fire({\n        icon: 'success',\n        title: 'Commande effectuée',\n        text: 'Merci pour votre commande!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n    }\n    console.log('after')\n    //update vente\n    var  newquantite ;\n    this.http.get(GlobalConstants.apiURL+'/ventes/getVentesbyID/'+data.id+'.json',{\n      headers: headers,\n    }).subscribe((vente: any)=>{\n     //+data.id+'.json')\n\n      console.log(\"produit vente: \"+vente['response'].data)\n      newquantite = vente['response'].data.quantite - data.qty\n    },(error) =>{\n\n    },()=>{\n       \n      let ventes = {\n        \"quantite\":newquantite,\n      }\n      const body=JSON.stringify(ventes);\n      this.http.post(GlobalConstants.apiURL+'/ventes/updateVentes/'+data.id+'.json',body,{\n        headers: headers,\n      }).subscribe((rep:any)=>{\n        console.log(\"updating vente\",rep['response'])\n      })\n\n    })\n   //update produit vente\n   //this.panierService.removePanier()\n    //this.router.navigate(['/login']);\n    }else if(res['response']['code'] === \"404\"){\n      if(listenumer ===0){\n      Swal.fire({\n        icon: 'error',\n        title: 'Commande refusé!',\n        text: 'Veuillez contactez le service client!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n      return true\n    //  localStorage.setItem('commaandeOK',\"false\")\n    }\n    }else{\n     //this.alertConfirmation()\n     if(listenumer ===0){\n     Swal.fire({\n      icon: 'error',\n      title: 'Inscription refusé!',\n      text: 'veuillez verifier votre connexion internet!',\n      showConfirmButton: true,\n      timer: 2000\n    });\n    localStorage.setItem('commaandeOK',\"false\")\n      }\n    }\n    }\n   );\n  }\n  GetUser(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.api_auth+\"/getuser/\"+ localStorage.getItem('iduser')+\".json\",{ headers: headers })\n  }\n}\n"]}