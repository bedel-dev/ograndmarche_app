{"version":3,"sources":["./src/app/services/commandes/commande.service.ts"],"names":[],"mappings":"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","file":"default~components-pages-commande-commande-module-ngfactory~components-pages-wishlist-wishlist-modul~ef7e0519-es2015.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { Observable, of } from 'rxjs'\nimport { GlobalConstants } from '../../common/global-constants';\nimport Swal from 'sweetalert2';\nimport { Router } from '@angular/router';\nimport { PanierService } from '../paniers/panier.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CommandeService {\n\n  constructor(public http:HttpClient,public router:Router,public panierService: PanierService) { }\n  token =  localStorage.getItem('token')\n   iduser = localStorage.getItem('iduser');\n\n testvar:any = []\n\n\n\n\n  // var commandeGenerale = {\n  //   \"quantitetotalCommande\":quantitetotalCommande,\n  //   \"montantTotaCommande\":montantTotaCommande,\n  //   \"montantlivraison\":montantlivraison,\n  //   \"statut\":statut,\n  //   \"numero_commande\":numero_commande,\n  //   \"vendeurID\":vendeurID,\n  //   \"userId\":iduser\n  //  }\n\n  GetCommandeByuser(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.apiURL+\"/commandes/getuserIdcommande/\"+this.iduser+\".json\",{ headers: headers })\n  }\n  GetProduitBycomamnde(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.apiURL+\"/produitcommande/listProduitcommande.json\",{ headers: headers })\n  }\n\n  terminate =false\n  AddCommande(data,listprod){\n    let  re =  false;\n    Swal.fire('Patientez svp!!!')\n    Swal.showLoading(Swal.getDenyButton())\n    var idcommande = 0;\n    let commande = {\n    \"venteId\":data.venteId,\n    \"userId\": data.userId,\n    \"vendeurId\":data.vendeurID,\n    \"quantite\":data.quantitetotalCommande,\n    \"montant\":data.montantTotaCommande,\n    \"statut\":\"en attente\",\n    \"numero_commande\":String(Math.floor(100000 + Math.random() * 900000)),\n    \"montantlivraison\":data.montantlivraison\n    }\n    this.token = localStorage.getItem('token')\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n    })\n    const body=JSON.stringify(commande);\n   // console.log(this.token);\n    // console.log(\"voici le token dans commande : \",this.token)\n    // console.log(\"voici le token dans commande : \",this.iduser)\n\n    this.http\n     .post(GlobalConstants.apiURL+'/commandes/addCommandes.json', body, {\n       headers: headers,\n     })\n    .subscribe((res) =>{\n\n\n  //  console.log(res);\n\n    if(res['message']===\"authentication failed Token not valide\"){\n      \n        Swal.fire({\n          icon: 'error',\n          title: 'Commande refusé',\n          text: 'Votre session a expiré!',\n          showConfirmButton: true,\n          timer: 2000\n        });\n        this.router.navigate(['/login']);\n         re = false\n     }\n    else if(res['response']['code'] === \"200\"){\n      \n    //  Swal.fire({\n    //   icon: 'success',\n    //   title: 'Commande effectuée',\n    //   text: 'Merci pour votre commande!',\n    //   showConfirmButton: true,\n    //   timer: 2000\n    //  });\n     idcommande = res['response']['idcommande']\n     var number =listprod.length\n     for(const item of listprod) {\n       number -= 1;\n      // console.log(item)\n        this.AddProduitCommande(item,number,idcommande)\n     }\n     //this.panierService.removePanier();\n     //this.cart = []\n    // console.log(idcommande)\n   //this.panierService.removePanier()\n    //this.router.navigate(['/login']);\n    \n     re = true  \n    }\n    else if(res['response']['code'] === \"404\"){\n\n      Swal.fire({\n        icon: 'error',\n        title: 'Commande refusé!',\n        text: 'Veuillez contactez le service client!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n      re = false\n    }else{\n     //this.alertConfirmation()\n     Swal.fire({\n      icon: 'error',\n      title: 'Commande refusé!',\n      text: 'veuillez verifier votre connexion internet!',\n      showConfirmButton: true,\n      timer: 2000\n    });\n    re =false\n     }\n    }\n   );\n   return re;\n  }\n  AddProduitCommande(data,listenumer:number,idcommande){\n    //Swal.fire('Patientez svp!!!')\n    //Swal.showLoading(Swal.getDenyButton())\n    console.log(listenumer)\n    let produitcommande = {\n      \"idcommande\":idcommande,\n      \"titre\":data.title,\n      \"prixunitaire\":data.price,\n      \"quantite\":data.qty,\n      \"Idvendeur\":data.idprod,\n      \"idvente\":data.id\n    }\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n    })\n    const body=JSON.stringify(produitcommande);\n    var alert= true;\n    console.log(this.token);\n    this.http\n     .post(GlobalConstants.apiURL+'/produitcommande/addProduitcommande.json', body, {\n       headers: headers,\n     })\n\n    .subscribe((res) =>{\n    console.log(res);\n    if(res['message']===\"authentication failed Token not valide\"){\n      if(listenumer ===0){\n        Swal.fire({\n          icon: 'error',\n          title: 'Commande refusé',\n          text: 'Votre session a expiré!',\n          showConfirmButton: true,\n          timer: 2000\n        });\n        this.router.navigate(['/login']);\n      }\n\n     }\n    else if(res['response']['code'] === \"200\"){\n      if(listenumer ===0){\n        this.testvar.push(\"1\");\n        console.log(\"this.testvar :\",this.testvar);\n      Swal.fire({\n        icon: 'success',\n        title: 'Commande effectuée',\n        text: 'Merci pour votre commande!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n    }\n    console.log('after')\n    //update vente\n    var  newquantite ;\n    this.http.get(GlobalConstants.apiURL+'/ventes/getVentesbyID/'+data.id+'.json',{\n      headers: headers,\n    }).subscribe((vente: any)=>{\n     //+data.id+'.json')\n\n      console.log(\"produit vente: \"+vente['response'].data)\n      newquantite = vente['response'].data.quantite - data.qty\n    },(error) =>{\n\n    },()=>{\n       \n      let ventes = {\n        \"quantite\":newquantite,\n      }\n      const body=JSON.stringify(ventes);\n      this.http.post(GlobalConstants.apiURL+'/ventes/updateVentes/'+data.id+'.json',body,{\n        headers: headers,\n      }).subscribe((rep:any)=>{\n        console.log(\"updating vente\",rep['response'])\n      })\n\n    })\n   //update produit vente\n   //this.panierService.removePanier()\n    //this.router.navigate(['/login']);\n    }else if(res['response']['code'] === \"404\"){\n      if(listenumer ===0){\n      Swal.fire({\n        icon: 'error',\n        title: 'Commande refusé!',\n        text: 'Veuillez contactez le service client!',\n        showConfirmButton: true,\n        timer: 2000\n      });\n      return true\n    //  localStorage.setItem('commaandeOK',\"false\")\n    }\n    }else{\n     //this.alertConfirmation()\n     if(listenumer ===0){\n     Swal.fire({\n      icon: 'error',\n      title: 'Inscription refusé!',\n      text: 'veuillez verifier votre connexion internet!',\n      showConfirmButton: true,\n      timer: 2000\n    });\n    localStorage.setItem('commaandeOK',\"false\")\n      }\n    }\n    }\n   );\n  }\n  GetUser(){\n\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${localStorage.getItem('token')}`\n  })\n   return this.http.get(GlobalConstants.api_auth+\"/getuser/\"+ localStorage.getItem('iduser')+\".json\",{ headers: headers })\n  }\n}\n"],"sourceRoot":"webpack:///"}